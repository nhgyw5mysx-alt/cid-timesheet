<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>TimeLatch</title>

  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@600;700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    /* BACKGROUND + PARTICLES */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: #0a0e1a;
      color: white;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
      padding: 24px 16px;
    }

    canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    .app {
      max-width: 500px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* CARD BASE – SUBTLE OVERLAP */
    .card {
      background: rgba(20, 26, 46, 0.94);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
      border: 1px solid rgba(0, 212, 255, 0.3);
      border-radius: 32px;
      padding: 28px;
      margin-bottom: -28px; /* SUBTLE OVERLAP */
      position: relative;
      box-shadow: 0 14px 36px rgba(0, 212, 255, 0.18);
      overflow: hidden;
    }

    .card:first-child { margin-top: 0; }
    .card:last-child { margin-bottom: 50px; }

    /* HEADER – GLOWING TITLE */
    .header-card {
      text-align: center;
      padding: 32px 28px 48px;
      margin-bottom: -20px;
    }
    .logo-img {
      width: 100px;
      height: auto;
      border-radius: 20px;
      margin: 12px auto;
      box-shadow: 0 0 30px rgba(0,212,255,0.5);
      animation: pulse 3s infinite;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 25px rgba(0,212,255,0.4); }
      50% { box-shadow: 0 0 40px rgba(0,212,255,0.7); }
    }
    h1 {
      font-family: 'Exo 2', sans-serif;
      font-size: 42px;
      font-weight: 700;
      background: linear-gradient(90deg, #00d4ff, #00aaff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 15px rgba(0,212,255,0.4);
      margin-top: 16px;
    }

    /* NAME CARD */
    .name-card h2 {
      font-size: 28px;
      color: #00d4ff;
      text-align: center;
      margin-bottom: 20px;
      font-weight: 700;
    }
    .name-card input {
      width: 100%;
      padding: 20px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(0,212,255,0.25);
      border-radius: 22px;
      color: white;
      font-size: 20px;
      text-align: center;
    }

    /* DATE */
    .today-date {
      font-family: 'Exo 2', sans-serif;
      font-size: 30px;
      font-weight: 700;
      color: #00d4ff;
      text-align: center;
      margin: 32px 0 20px;
      text-shadow: 0 0 10px rgba(0,212,255,0.4);
    }

    /* TIME CARD */
    .time-card .time-inputs {
      display: flex;
      gap: to: 16px;
      margin: 20px 0;
    }
    .time-field {
      flex: 1;
      background: rgba(20, 26, 46, 0.8);
      border-radius: 24px;
      padding: 20px 0;
      text-align: center;
      border: 1px solid rgba(0,212,255,0.25);
    }
    .time-field > div {
      font-size: 18px;
      color: #00d4ff;
      margin-bottom: 8px;
      font-weight: 600;
    }
    .time-field input {
      background: transparent;
      border: none;
      color: white;
      font-size: 38px;
      font-weight: bold;
      text-align: center;
      width: 100%;
      outline: none;
    }

    /* JOB & NOTES */
    .section-title {
      font-size: 28px;
      color: #00d4ff;
      text-align: center;
      margin: 20px 0 16px;
      font-weight: 700;
    }
    select, textarea {
      width: 100%;
      padding: 20px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(0,212,255,0.25);
      border-radius: 22px;
      color: white;
      font-size: 19px;
      margin: 12px 0;
    }
    textarea { height: 160px; resize: none; }

    /* BUTTON */
    button {
      width: 100%;
      padding: 22px;
      background: #00d4ff;
      color: #0a0e1a;
      border: none;
      border-radius: 24px;
      font-size: 24px;
      font-weight: bold;
      margin: 20px 0;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0,212,255,0.35);
      transition: 0.3s;
    }
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 28px rgba(0,212,255,0.45);
    }
    .copy { background: #00ff9d; padding: 26px; font-size: 28px; }
    .delete-all { background: #ff3b5c; color: white; padding: 26px; font-size: 28px; }

    /* OUTPUT */
    .day {
      background: rgba(20, 26, 46, 0.85);
      border-radius: 20px;
      padding: 20px;
      margin: 16px 0;
      border: 1px solid rgba(0,212,255,0.2);
    }
    pre {
      background: rgba(0,0,0,0.3);
      padding: 16px;
      border-radius: 16px;
      white-space: pre-wrap;
      font-size: 17px;
      margin: 12px 0;
      line-height: 1.6;
      max-height: 160px;
      overflow-y: auto;
    }
    .ot { color: #00ff9d; font-weight: bold; }

    .job-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0,212,255,0.1);
      padding: 16px;
      margin: 10px 0;
      border-radius: 18px;
      font-size: 18px;
      border: 1px solid rgba(0,212,255,0.2);
    }
    .delete-x {
      background: #ff3b5c;
      color: white;
      border: none;
      width: 38px;
      height: 38px;
      border-radius: 50%;
      font-size: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <canvas id="particles"></canvas>

  <div class="app">

    <!-- HEADER -->
    <div class="card header-card">
      <img src="IMG_2776.jpeg" alt="TimeLatch Logo" class="logo-img">
      <h1>TimeLatch</h1>
    </div>

    <!-- NAME -->
    <div class="card name-card">
      <h2>Your Name</h2>
      <input type="text" id="user-name" placeholder="e.g. Daniel">
    </div>

    <!-- DATE -->
    <div class="today-date" id="today-date"></div>

    <!-- TIME -->
    <div class="card time-card">
      <div class="time-inputs">
        <div class="time-field"><div>START</div><input type="time" id="start-time" value="07:00"></div>
        <div class="time-field"><div>FINISH</div><input type="time" id="finish-time" value="15:30"></div>
      </div>
    </div>

    <!-- JOB -->
    <div class="card">
      <div class="section-title">Job Location</div>
      <select id="job">
        <option value="CSL Broadmeadows">CSL Broadmeadows</option>
        <option value="CSL Tullamarine">CSL Tullamarine</option>
        <option value="CSL Melbourne">CSL Melbourne</option>
        <option value="other">+ Add Custom Location</option>
      </select>
      <input type="text" id="custom" placeholder="Type new location…" style="display:none;margin-top:12px">
    </div>

    <!-- SAVED JOBS -->
    <div class="card">
      <div class="section-title">Saved Locations</div>
      <div id="saved-jobs"></div>
    </div>

    <!-- NOTES -->
    <div class="card">
      <div class="section-title">Today's Notes</div>
      <textarea id="notes" placeholder="Type everything here…"></textarea>
      <button id="add-btn">ADD TODAY'S ENTRY</button>
    </div>

    <!-- WEEK -->
    <div class="card">
      <div class="section-title">Your Week So Far</div>
      <div id="output"></div>
    </div>

    <!-- ACTIONS -->
    <div style="padding: 0 20px; margin-top: -20px;">
      <button class="copy" onclick="copyAll()">Copy Timesheet</button>
      <button class="delete-all" onclick="deleteAll()">DELETE ALL ENTRIES</button>
    </div>

  </div>

  <script>
    // PARTICLES
    const canvas = document.getElementById('particles');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const particles = [];
    for (let i = 0; i < 50; i++) {
      particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 1.5 + 1,
        speed: Math.random() * 0.4 + 0.2,
        angle: Math.random() * Math.PI * 2
      });
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p => {
        p.x += Math.cos(p.angle) * p.speed;
        p.y += Math.sin(p.angle) * p.speed;
        if (p.x < 0 || p.x > canvas.width) p.angle = Math.PI - p.angle;
        if (p.y < 0 || p.y > canvas.height) p.angle = -p.angle;

        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(0, 212, 255, 0.5)';
        ctx.fill();
      });
      requestAnimationFrame(animate);
    }
    animate();
    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    // APP LOGIC
    const now = new Date();
    const melb = { timeZone: 'Australia/Melbourne' };
    document.getElementById('today-date').innerText = now.toLocaleDateString('en-AU', {
      ...melb, weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'
    });
    const today = now.toLocaleDateString('en-CA', melb);

    const lastMonday = new Date(now);
    lastMonday.setDate(now.getDate() - ((now.getDay() + 6) % 7));
    const weekEnding = lastMonday.toLocaleDateString('en-AU', {
      ...melb, weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'
    });

    let week = JSON.parse(localStorage.getItem('timelatch_week') || '{}');
    let customJobs = JSON.parse(localStorage.getItem('timelatch_jobs') || '[]');

    function save() { localStorage.setItem('timelatch_week', JSON.stringify(week)); }
    function saveJobs() { localStorage.setItem('timelatch_jobs', JSON.stringify(customJobs)); renderJobs(); }
    function saveName() {
      const name = document.getElementById('user-name').value.trim();
      if (name) localStorage.setItem('timelatch_name', name);
    }

    const jobSelect = document.getElementById('job');
    jobSelect.onchange = () => {
      document.getElementById('custom').style.display = jobSelect.value === 'other' ? 'block' : 'none';
    };

    function renderJobs() {
      let html = customJobs.map((j, i) =>
        `<div class="job-item"><span>${j}</span><button class="delete-x" onclick="customJobs.splice(${i},1);saveJobs()">X</button></div>`
      ).join('');
      document.getElementById('saved-jobs').innerHTML = html || '<div style="color:#666;padding:20px;text-align:center;font-size:17px">No custom locations yet</div>';
      while (jobSelect.options.length > 4) jobSelect.remove(4);
      customJobs.forEach(j => jobSelect.add(new Option(j, j), jobSelect.options[jobSelect.options.length - 1]));
    }

    function timeToMins(t) { const [h, m] = t.split(':').map(Number); return h * 60 + m; }

    document.getElementById('add-btn').addEventListener('click', function () {
      saveName();
      let job = jobSelect.value;
      if (job === 'other') {
        job = document.getElementById('custom').value.trim();
        if (!job) { alert('Type a location!'); return; }
        if (!customJobs.includes(job)) { customJobs.unshift(job); saveJobs(); }
      }
      const notes = document.getElementById('notes').value.trim();
      if (!notes) { alert('Add notes!'); return; }

      const start = document.getElementById('start-time').value || "07:00";
      const finish = document.getElementById('finish-time').value || "15:30";
      const startMins = timeToMins(start);
      const finishMins = timeToMins(finish);

      if (week[today]) {
        for (let e of week[today]) {
          const eStart = timeToMins(e.times.split(' – ')[0]);
          const eEnd = timeToMins(e.times.split(' – ')[1]);
          if (startMins < eEnd && finishMins > eStart) {
            alert('TIME CLASH! Already have ' + e.times); return;
          }
        }
      }

      const raw = (finishMins - startMins) / 60;
      const isSat = now.getDay() === 6;
      let normal = 0, ot = 0;
      if (isSat) {
        ot = raw;
      } else {
        const dayStart = 7 * 60;
        const dayEnd = 15.5 * 60;
        const before = Math.max(0, Math.min(finishMins, dayStart) - startMins) / 60;
        const during = Math.max(0, Math.min(finishMins, dayEnd) - Math.max(startMins, dayStart)) / 60;
        const after = Math.max(0, finishMins - Math.max(startMins, dayEnd)) / 60;
        ot = before + after;
        normal = during > 0 ? during - 0.5 : 0;
      }

      const paid = (normal + ot).toFixed(2);
      const entry = { times: start + ' – ' + finish, paid, ot: ot.toFixed(2), notes, job };
      if (!week[today]) week[today] = [];
      week[today].push(entry);
      save(); render();

      if ('vibrate' in navigator) { navigator.vibrate([100, 50, 100]); }

      document.getElementById('notes').value = '';
      jobSelect.value = 'CSL Broadmeadows';
      document.getElementById('custom').style.display = 'none';
      document.getElementById('custom').value = '';
      alert('ENTRY ADDED!');
    });

    function render() {
      let html = '';
      Object.keys(week).sort().reverse().forEach(date => {
        const dayName = new Date(date + 'T12:00:00').toLocaleDateString('en-AU', { ...melb, weekday: 'long', day: 'numeric', month: 'short' });
        week[date].forEach(e => {
          const otTag = e.ot > 0 ? ` <span class="ot">(OT: ${e.ot} hrs)</span>` : '';
          html += `<div class="day">
            <b>${dayName}</b> | ${e.job}<br>
            ${e.times}   <b>${e.paid} hrs</b>${otTag}<pre>${e.notes}</pre>
          </div>`;
        });
      });
      document.getElementById('output').innerHTML = html || '<div style="text-align:center;padding:60px;color:#666;font-size:17px">No entries yet</div>';
    }

    function copyAll() {
      saveName();
      const name = document.getElementById('user-name').value.trim() || 'Your';
      let text = `${name}’s Timesheet – Week ending ${weekEnding}\n\n`;
      Object.keys(week).sort().reverse().forEach(date => {
        const dayName = new Date(date + 'T12:00:00').toLocaleDateString('en-AU', { ...melb, weekday: 'long', day: 'numeric', month: 'short' });
        week[date].forEach(e => {
          const otTag = e.ot > 0 ? ` (OT: ${e.ot} hrs)` : '';
          text += `${dayName} | ${e.job}\n${e.times}   ${e.paid} hrs${otTag}\n${e.notes}\n\n`;
        });
      });
      navigator.clipboard.writeText(text);
      alert('COPIED! Paste into email');
    }

    function deleteAll() {
      if (confirm('DELETE EVERYTHING?')) { week = {}; save(); render(); alert('ALL GONE'); }
    }

    render();
    renderJobs();
  </script>
</body>
</html>